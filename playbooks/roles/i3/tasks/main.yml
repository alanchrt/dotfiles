---
- name: Install i3 custom facts
  become: yes
  copy: src=i3.fact
        dest=/etc/ansible/facts.d/i3.fact
        mode=0755

- name: Reload ansible local facts
  setup: filter=ansible_local

- name: Remove system python docutils
  become: yes
  pip: name=docutils
       state=absent
  when: not ansible_local.i3.docutils_installed

- name: Install i3-related software
  yaourt: name={{item}}
          state=present
  with_items:
    - cmake
    - python-docutils
    - slock
    - xss-lock
    - unclutter
    - rofi
    - feh
    - gnome-screenshot

- name: Create autologin group
  become: yes
  group: name=autologin
         state=present

- name: Add login user to autologin group
  become: yes
  user: name="{{ansible_env.USER}}"
        groups=autologin
        append=yes

- name: Set i3 as autologin window manager in LightDM
  become: yes
  blockinfile:
    dest: /etc/lightdm/lightdm.conf
    marker: '# {mark} AUTOLOGIN CONFIG'
    block: |
      [SeatDefaults]
      pam-service=lightdm
      pam-autologin-service=lightdm-autologin
      autologin-user={{ansible_env.USER}}
      autologin-user-timeout=0
      session-wrapper=/etc/lightdm/Xsession

- name: Install i3 python library
  become: yes
  pip: name=i3-py
       state=present

- name: Remove system default i3 configs
  file: path={{item}}
        state=absent
  with_items:
    - "{{ansible_env.HOME}}/.i3"
    - "{{ansible_env.HOME}}/.i3status.conf"
